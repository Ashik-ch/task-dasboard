<div class="p-4">
    <button (click)="onAddTask()" class="bg-blue-500 text-white px-4 py-2 rounded mb-4"> Add New Task </button>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <!-- To Do -->
        <div>
            <h2 class="text-lg font-bold mb-2">To Do</h2>
            <div cdkDropList id="todoList" class="min-h-[300px] p-2 bg-gray-100 rounded" [cdkDropListData]="todo"
                [cdkDropListConnectedTo]="['inProgressList', 'doneList']" (cdkDropListDropped)="onDrop($event, 'todo')">
                @for (task of todo; track $index) {
                <div cdkDrag class="bg-white p-3 mb-2 rounded shadow space-y-2 relative">
                    <div class="flex justify-between items-center">
                        <div class="text-sm font-semibold">{{ task.title }}</div>
                        <button (click)="openDropdown = { list: 'todo', index: $index }"
                            class="text-gray-500 hover:text-gray-700"> &#8942; </button>
                    </div>
                    @if (openDropdown?.list === 'todo' && openDropdown?.index === $index) {
                    <div class="absolute right-0 mt-2 bg-white border rounded shadow z-10">
                        <ul>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'todo'); openDropdown = null">To Do</li>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'inProgress'); openDropdown = null">In Progress</li>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'done'); openDropdown = null">Done</li>
                        </ul>
                    </div>
                    }
                </div>
                }
            </div>
        </div>

        <!-- In Progress -->
        <div>
            <h2 class="text-lg font-bold mb-2">In Progress</h2>
            <div cdkDropList id="inProgressList" class="min-h-[300px] p-2 bg-gray-100 rounded"
                [cdkDropListData]="inProgress" [cdkDropListConnectedTo]="['todoList', 'doneList']"
                (cdkDropListDropped)="onDrop($event, 'inProgress')">
                @for (task of inProgress; track $index) {
                <div cdkDrag class="bg-white p-3 mb-2 rounded shadow space-y-2 relative">
                    <div class="flex justify-between items-center">
                        <div class="text-sm font-semibold">{{ task.title }}</div>
                        <button (click)="openDropdown = { list: 'inProgress', index: $index }"
                            class="text-gray-500 hover:text-gray-700">
                            &#8942;
                        </button>
                    </div>
                    @if (openDropdown?.list === 'inProgress' && openDropdown?.index === $index) {
                    <div class="absolute right-0 mt-2 bg-white border rounded shadow z-10">
                        <ul>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'todo'); openDropdown = null">To Do</li>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'inProgress'); openDropdown = null">In Progress</li>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'done'); openDropdown = null">Done</li>
                        </ul>
                    </div>
                    }
                </div>
                }
            </div>
        </div>

        <!-- Done -->
        <div>
            <h2 class="text-lg font-bold mb-2">Done</h2>
            <div cdkDropList id="doneList" class="min-h-[300px] p-2 bg-gray-100 rounded" [cdkDropListData]="done"
                [cdkDropListConnectedTo]="['todoList', 'inProgressList']" (cdkDropListDropped)="onDrop($event, 'done')">
                @for (task of done; track $index) {
                <div cdkDrag class="bg-white p-3 mb-2 rounded shadow space-y-2 relative">
                    <div class="flex justify-between items-center">
                        <div class="text-sm font-semibold">{{ task.title }}</div>
                        <button (click)="openDropdown = { list: 'done', index: $index }"
                            class="text-gray-500 hover:text-gray-700">
                            &#8942;
                        </button>
                    </div>
                    @if (openDropdown?.list === 'done' && openDropdown?.index === $index) {
                    <div class="absolute right-0 mt-2 bg-white border rounded shadow z-10">
                        <ul>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'todo'); openDropdown = null">To Do</li>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'inProgress'); openDropdown = null">In Progress</li>
                            <li class="px-4 py-2 hover:bg-gray-100 cursor-pointer"
                                (click)="onStatusChange(task, 'done'); openDropdown = null">Done</li>
                        </ul>
                    </div>
                    }
                </div>
                }
            </div>
        </div>
    </div>

    <!-- Task Modal -->
    @if (taskModalVisible) {
    <div class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
        <div class="bg-white p-4 rounded shadow-lg w-full max-w-md">
            <app-task (closeModal)="onCloseModal()"></app-task>
        </div>
    </div>
    }
</div>